$(document).ready(function(){$.glue.grid.x($.glue.conf.page.default_grid_x);$.glue.grid.y($.glue.conf.page.default_grid_y);for(i in $.glue.conf.page.guides_x){$.glue.grid.add_guide_x($.glue.conf.page.guides_x[i])}for(i in $.glue.conf.page.guides_y){$.glue.grid.add_guide_y($.glue.conf.page.guides_y[i])}var b=$('<img src="'+$.glue.base_url+'modules/page/page-title.png" alt="btn" title="change page title" width="32" height="32">');$(b).bind("click",function(c){var d=$("title").html();d=prompt("Change the page title",d);if(d===null){return}$("title").html(d);$.glue.backend({method:"glue.update_object",name:$.glue.page+".page","page-title":d})});$.glue.menu.register("page",b);b=$('<img src="'+$.glue.base_url+'modules/page/page-url.png" alt="btn" title="change the page&#039;s url" width="32" height="32">');$(b).bind("click",function(f){var c=$.glue.page.split(".").shift();var d=prompt("Change the page URL",c);if(d!=null&&d!=c){$.glue.backend({method:"glue.get_startpage"},function(e){var g=false;if(e==$.glue.page){g=true}$.glue.backend({method:"glue.rename_page",old:c,"new":d},function(h){if(g){$.glue.backend({method:"glue.set_startpage",page:d+".head"},function(j){window.location=$.glue.base_url+"?"+d+"/edit"})}else{window.location=$.glue.base_url+"?"+d+"/edit"}})})}$.glue.menu.hide()});$.glue.menu.register("page",b);b=$('<img src="'+$.glue.base_url+'modules/page/page-set-startpage.png" alt="btn" title="make this the start page" width="32" height="32">');$(b).bind("click",function(c){$.glue.backend({method:"glue.set_startpage",page:$.glue.page});$.glue.menu.hide()});$.glue.menu.register("page",b);b=$('<img src="'+$.glue.base_url+'img/background-color.png" alt="btn" title="change the background color" width="32" height="32">');$(b).bind("click",function(d){if($("html").css("background-image").length!=0&&$("html").css("background-image")!="none"){if(confirm("Do you want to clear the current background image?")){$.glue.backend({method:"page.clear_background_img",page:$.glue.page});$("html").css("background-image","")}else{$.glue.menu.hide();return}}var c=$("html").css("background-color");if(d.shiftKey){c=prompt("Enter background color (e.g. #ff0000 or rgb(255, 0, 0))",c);if(!c){return}}$.glue.colorpicker.show(c,false,function(e){$("html").css("background-color",e)},function(e){$.glue.grid.update(true);$.glue.backend({method:"glue.update_object",name:$.glue.page+".page","page-background-color":e})});$.glue.menu.hide()});$.glue.menu.register("page",b);b=$('<img src="'+$.glue.base_url+'modules/page/page-new.png" alt="btn" title="create a new page" width="32" height="32">');$(b).bind("click",function(d){$.glue.menu.hide();var c=prompt("Name the page to be created");if(c===null){return}$.glue.backend({method:"glue.create_page",page:c+".head"},function(e){window.location=$.glue.base_url+"?"+c+"/edit"})});$.glue.menu.register("page",b);b=$('<img src="'+$.glue.base_url+'modules/page/page-delete.png" alt="btn" title="delete page" width="32" height="32">');$(b).bind("click",function(f){if(confirm("Really delete the current page and all it's revisions?")){var d=$.glue.page.split(".").shift();var c=[];$.glue.backend({method:"glue.revisions",pagename:d},function(h){for(var e in h){c.push(d+"."+h[e])}for(var g in c){$.glue.backend({method:"glue.delete_page",page:c[g]})}window.location=$.glue.base_url+"?pages"})}$.glue.menu.hide()});$.glue.menu.register("page",b);b=$('<div style="height: 32px; max-height: 32px; max-width: 32px; overflow: hidden; width: 32px;"><img src="'+$.glue.base_url+'modules/page/page-background-image.png" alt="btn" width="32" height="32"></div>');var a={error:function(c){if(c&&c.target&&c.target.status){$.glue.error("There was a problem uploading a file (status "+c.target.status+")")}else{$.glue.error("There was a problem uploading a file. Make sure you are not exceeding the file size limits set in the server configuration.");console.error(c)}$.glue.menu.hide()},finish:function(c){if(!c){$.glue.error("There was a problem communicating with the server")}else{if(c["#error"]){$.glue.error("There was a problem uploading the file ("+c["#data"]+")")}else{$("html").css("background-image","url("+$.glue.base_url+"?"+$.glue.page+".page&"+(new Date().getTime())+")")}}$.glue.menu.hide()},tooltip:"upload a background image"};$.glue.upload.button(b,{method:"glue.upload_files",page:$.glue.page,preferred_module:"page"},a);$.glue.menu.register("page",b);b=$('<div id="glue-menu-page-background-scroll" alt="btn" style="height: 32px; width: 32px;" title="toggle between having the background image fixed or having it scroll with the rest of the page">');$(b).bind("glue-menu-activate",function(d){var c=$("#glue-menu-page-background-scroll");if($("html").css("background-image").length!=0&&$("html").css("background-image")!="none"){if($("html").css("background-attachment")=="fixed"){$(c).removeClass("glue-menu-enabled");$(c).addClass("glue-menu-disabled")}else{$(c).addClass("glue-menu-enabled");$(c).removeClass("glue-menu-disabled")}$(c).css("display","block")}else{$(c).css("display","none")}});$(b).bind("click",function(c){if($("html").css("background-attachment")=="fixed"){$("html").css("background-attachment","scroll");$.glue.backend({method:"glue.update_object",name:$.glue.page+".page","page-background-attachment":"scroll"});$(this).addClass("glue-menu-enabled");$(this).removeClass("glue-menu-disabled")}else{$("html").css("background-attachment","fixed");$.glue.backend({method:"glue.update_object",name:$.glue.page+".page","page-background-attachment":"fixed"});$(this).removeClass("glue-menu-enabled");$(this).addClass("glue-menu-disabled")}});$.glue.menu.register("page",b);b=$('<img src="'+$.glue.base_url+'modules/page/page-background-image-pos.png" alt="btn" title="adjust background image selection" width="32" height="32">');$(b).bind("glue-menu-activate",function(d){var c=$("#glue-menu-page-background-scroll");if($("html").css("background-image").length!=0&&$("html").css("background-image")!="none"){$(c).css("display","block")}else{$(c).css("display","none")}});$(b).bind("mousedown",function(h){var d=$("html").css("background-position").split(" ");if(d.length!=2){var c=0;var f=0}else{var c=parseInt(d[0]);if(isNaN(c)){c=0}var f=parseInt(d[1]);if(isNaN(f)){f=0}}var g=true;$.glue.slider(h,function(e,j){$("html").css("background-position",(c+e)+"px "+(f+j)+"px");if(e!=0||j!=0){g=false}},function(e,j){if(g){$("html").css("background-position","");$.glue.backend({method:"glue.object_remove_attr",name:$.glue.page+".page",attr:"page-background-image-position"})}else{$.glue.backend({method:"glue.update_object",name:$.glue.page+".page","page-background-image-position":$("html").css("background-position")})}});return false});$.glue.menu.register("page",b);b=$('<img src="'+$.glue.base_url+'modules/page/page-grid.png" width="32" height="32">');$(b).attr("title","show/hide grid or change grid size by dragging ("+$.glue.grid.x()+"x"+$.glue.grid.y()+")");$(b).bind("mousedown",function(d){var c=this;$.glue.slider(d,function(e,h,f){if(f.shiftKey){if(e<h){e=h}else{h=e}}var g=false;if(10<=Math.abs(e)){$.glue.grid.mode(1);$.glue.grid.x(Math.abs(e));g=true}if(10<=Math.abs(h)){$.glue.grid.mode(1);$.glue.grid.y(Math.abs(h));g=true}if(g){$.glue.grid.update(true)}},function(e,f){if(Math.abs(e)<10&&Math.abs(f)<10){if($.glue.grid.mode()){$.glue.grid.mode(0)}else{$.glue.grid.mode(1)}$.glue.grid.update()}$.glue.backend({method:"page.set_grid",x:$.glue.grid.x(),y:$.glue.grid.y()});$(c).attr("title","show/hide grid or change grid size by dragging ("+$.glue.grid.x()+"x"+$.glue.grid.y()+")");$.glue.menu.hide()});return false});$.glue.menu.register("page",b,13)});