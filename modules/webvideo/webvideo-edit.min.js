$(document).ready(function(){var a=$('<img src="'+$.glue.base_url+'modules/webvideo/webvideo.png" alt="btn" title="embed a youtube or vimeo video" width="32" height="32">');$(a).bind("click",function(d){var c=prompt("Enter the video URL (e.g. http://www.youtube.com/watch?v=_mdVHEus0T8)");if(!c){return}var f=false;if(c.indexOf("youtube")!=-1){var h=c.indexOf("v=");if(h==-1){$.glue.error("Error understanding the youtube link")}else{h+=2;var b=c.indexOf("&",h);if(b==-1){b=c.length}f="youtube";var g=c.slice(h,b)}}else{if(c.indexOf("vimeo")!=-1){var h=c.indexOf(".com/");if(h==-1){$.glue.error("Error understanding the vimeo link")}else{h+=5;f="vimeo";var g=String(parseInt(c.slice(h)))}}else{$.glue.error("Only youtube and vimeo videos are supported at the moment.")}}if(f){$.glue.backend({method:"glue.create_object",page:$.glue.page},function(i){var e=$('<div class="webvideo resizable object" style="position: absolute;"></div>');$(e).attr("id",i.name);if(f=="youtube"){var j="//";var k=$('<iframe class="youtube-player" src="'+j+"www.youtube.com/embed/"+g+'?rel=0" style="border-width: 0px; height: 100%; position: absolute; width: 100%;"></iframe>')}else{if(f=="vimeo"){var j="//";var k=$('<iframe src="'+j+"player.vimeo.com/video/"+g+'?title=0&amp;byline=0&amp;portrait=0&amp;color=ffffff" style="border-width: 0px; height: 100%; position: absolute; width: 100%;"></iframe>')}}$(e).append(k);k=$('<div class="glue-webvideo-handle glue-ui" title="drag here"></div>');$(e).append(k);$("body").append(e);$(e).css("width",$(e).width()+"px");$(e).css("height",$(e).height()+"px");$(e).css("left",(d.pageX-$(e).outerWidth()/2)+"px");$(e).css("top",(d.pageY-$(e).outerHeight()/2)+"px");$.glue.object.register(e);$.glue.backend({method:"glue.update_object",name:$(e).attr("id"),"webvideo-provider":f,"webvideo-id":g});$.glue.object.save(e)})}$.glue.menu.hide()});$.glue.menu.register("new",a,13);var a=$('<div style="height: 32px; width: 32px;" title="toggle automatic playback of video (takes effect after a reload)">');$(a).bind("glue-menu-activate",function(d){var c=$(this).data("owner");if($(c).data("webvideo-autoplay")===undefined){$(this).removeClass("glue-menu-enabled");$(this).removeClass("glue-menu-disabled");var b=this;$.glue.backend({method:"glue.load_object",name:$(c).attr("id")},function(e){if(e["webvideo-autoplay"]=="autoplay"){$(b).addClass("glue-menu-enabled");$(c).data("webvideo-autoplay","autoplay")}else{$(b).addClass("glue-menu-disabled");$(c).data("webvideo-autoplay","")}})}else{if($(c).data("webvideo-autoplay")=="autoplay"){$(this).addClass("glue-menu-enabled");$(this).removeClass("glue-menu-disabled")}else{$(this).removeClass("glue-menu-enabled");$(this).addClass("glue-menu-disabled")}}});$(a).bind("click",function(c){var b=$(this).data("owner");if($(this).hasClass("glue-menu-enabled")){$(this).removeClass("glue-menu-enabled");$(this).addClass("glue-menu-disabled");$(b).data("webvideo-autoplay","");$.glue.backend({method:"glue.object_remove_attr",name:$(b).attr("id"),attr:"webvideo-autoplay"})}else{if($(this).hasClass("glue-menu-disabled")){$(this).addClass("glue-menu-enabled");$(this).removeClass("glue-menu-disabled");$(b).data("webvideo-autoplay","");$.glue.backend({method:"glue.update_object",name:$(b).attr("id"),"webvideo-autoplay":"autoplay"})}}});$.glue.contextmenu.register("webvideo","webvideo-autoplay",a);a=$('<div style="height: 32px; width: 32px;" title="toggle looping of video (takes effect after a reload)">');$(a).bind("glue-menu-activate",function(d){var c=$(this).data("owner");if($(c).data("webvideo-loop")===undefined){$(this).removeClass("glue-menu-enabled");$(this).removeClass("glue-menu-disabled");var b=this;$.glue.backend({method:"glue.load_object",name:$(c).attr("id")},function(e){if(e["webvideo-loop"]=="loop"){$(b).addClass("glue-menu-enabled");$(c).data("webvideo-loop","loop")}else{$(b).addClass("glue-menu-disabled");$(c).data("webvideo-loop","")}})}else{if($(c).data("webvideo-loop")=="loop"){$(this).addClass("glue-menu-enabled");$(this).removeClass("glue-menu-disabled")}else{$(this).removeClass("glue-menu-enabled");$(this).addClass("glue-menu-disabled")}}});$(a).bind("click",function(c){var b=$(this).data("owner");if($(this).hasClass("glue-menu-enabled")){$(this).removeClass("glue-menu-enabled");$(this).addClass("glue-menu-disabled");$(b).data("webvideo-loop","");$.glue.backend({method:"glue.object_remove_attr",name:$(b).attr("id"),attr:"webvideo-loop"})}else{if($(this).hasClass("glue-menu-disabled")){$(this).addClass("glue-menu-enabled");$(this).removeClass("glue-menu-disabled");$(b).data("webvideo-loop","loop");$.glue.backend({method:"glue.update_object",name:$(b).attr("id"),"webvideo-loop":"loop"})}}});$.glue.contextmenu.register("webvideo","webvideo-loop",a);$.glue.object.register_alter_pre_save("iframe",function(b,c){$(b).children("iframe").html("");$(b).children(".glue-webvideo-handle").remove()})});