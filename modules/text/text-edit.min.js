$.glue.text=function(){var a=function(e,d,b){if(typeof d!=="string"){if(d.toString){d=d.toString()}else{return""}}if(typeof b!=="string"){if(b.toString){b=b.toString()}else{return""}}var c=0;while(c+e.length<=b.length){if(b.substring(c,c+e.length)==e){b=b.substring(0,c)+d+b.substring(c+e.length);c+=d.length}else{c++}}return b};return{get_fonts:function(k,h){for(var f=0;f<document.styleSheets.length;f++){var g=document.styleSheets[f];for(var d=0;g.cssRules&&d<g.cssRules.length;d++){var l=g.cssRules[d];if(!l.selectorText){continue}if(l.selectorText.substr(0,10)!=".glue-font"){continue}var m=l.cssText;var b=m.indexOf("font-family:");if(b==-1){continue}b+=12;var c=m.length-1;var e=m.indexOf("}",b);if(e!=-1){c=e-1}e=m.indexOf(";",b);if(e!=-1&&e<c){c=e-1}k.push($.trim(m.substr(b,c-b+1)));if(l.selectorText.substr(0,15)==".glue-font-woff"){h.push($.trim(m.substr(b,c-b+1)))}}}},insert_at_cursor:function(d,c){var d=$(d).get(0);var e=d.selectionStart;var b=d.selectionEnd;d.value=d.value.substring(0,e)+c+d.value.substring(b,d.value.length);d.selectionStart=e+c.length;d.selectionEnd=e+c.length},render_content:function(c,b){c=a("$BASEURL$",$.glue.base_url,c);c=a("$baseurl$",$.glue.base_url,c);c=a("$GLUE$",a(",",".",$.glue.version),c);c=a("$glue$",a(",",".",$.glue.version),c);c=a("$OBJ$",b,c);c=a("$obj$",b,c);c=a("$PAGE$",$.glue.page,c);c=a("$page$",$.glue.page,c);c=a("$PAGENAME$",$.glue.page.split(".").slice(0,1),c);c=a("$pagename$",$.glue.page.split(".").slice(0,1),c);if(location.protocol=="https:"){c=a("$PROT$","https",c);c=a("$prot$","https",c)}else{c=a("$PROT$","http",c);c=a("$prot$","http",c)}c=a("$REV$",$.glue.page.split(".").slice(1,2),c);c=a("$rev$",$.glue.page.split(".").slice(1,2),c);if($.glue.conf.text.auto_br){c=a("\r\n","<br>",c);c=a("\n","<br>",c)}return c},stop_editing:function(b){$(b).children(".glue-text-render").html($.glue.text.render_content($(b).children(".glue-text-input").val(),$(b).attr("id")));$(b).removeClass("glue-text-editing");$(b).children(".glue-text-render").find("a").bind("click",function(c){return false});$(b).children(".glue-text-render").find("a").attr("title","this link is disabled for editing");$(b).children(".glue-text-render").find("a").each(function(){var c=$(this).attr("href");if(c&&c.charAt(0)!="#"&&c.indexOf("://")<1){$(this).attr("href",$.glue.base_url+c)}});$(b).children(".glue-text-input").css("display","none");$(b).children(".glue-text-render").css("display","block");$(b).children(".glue-text-input").text($(b).children(".glue-text-input").val());$.glue.backend({method:"glue.update_object",name:$(b).attr("id"),content:$(b).children(".glue-text-input").val()})}}}();$(".text").live("glue-register",function(a){$(this).children(".glue-text-input").bind("mousedown",function(b){if($(this).css("display")=="none"){return}else{b.stopPropagation()}});$(this).children(".glue-text-input").bind("keydown",function(b){if($(this).css("display")=="none"){return}else{b.stopPropagation()}if(b.which==9){$.glue.text.insert_at_cursor($(this),String.fromCharCode(9));b.preventDefault();return false}else{if(b.shiftKey&&b.which==32){$.glue.text.insert_at_cursor($(this),String.fromCharCode(160));b.preventDefault();return false}else{if(b.which==27){$.glue.text.stop_editing($(this).parent());b.preventDefault();return false}}}});$(this).children(".glue-text-input").bind("keypress",function(b){if($(this).css("display")=="none"){return}else{b.stopPropagation()}});$(this).children(".glue-text-input").bind("keyup",function(b){if($(this).css("display")=="none"){return}else{b.stopPropagation()}});$(this).children(".glue-text-render").find("a").bind("click",function(b){return false});$(this).children(".glue-text-render").find("a").attr("title","this link is disabled for editing")});$(".text").live("glue-deselect",function(a){if($(this).hasClass("glue-text-editing")){$.glue.text.stop_editing(this)}});$(".text.glue-selected").live("click",function(a){if($(this).hasClass("glue-text-editing")){return}if($(this).hasClass("glue-selected")){$(".glue-selected").not(this).each(function(){$.glue.sel.deselect(this)})}$(this).children(".glue-text-input").css("display","block");$(this).children(".glue-text-render").css("display","none");$(this).addClass("glue-text-editing");$(this).children(".glue-text-input").focus();if($(this).children(".glue-text-input").get(0).setSelectionRange){$(this).children(".glue-text-input").get(0).setSelectionRange(0,0)}});$(document).ready(function(){var b=$('<img src="'+$.glue.base_url+'modules/text/text.png" alt="btn" title="add a new text object" width="32" height="32">');$(b).bind("click",function(c){$.glue.backend({method:"glue.create_object",page:$.glue.page},function(f){var e=$('<div class="text resizable object" style="position: absolute;"><textarea class="glue-text-input" style="display: none; height: 100%; width: 100%;"></textarea><div class="glue-text-render" style="height: 100%; width: 100%;"></div></div>');$(e).attr("id",f.name);if($.glue.conf.object.default_colors){var d=Math.floor(Math.random()*$.glue.conf.object.default_colors.length);$(e).css("background-color",$.glue.conf.object.default_colors[d])}$("body").append(e);$(e).css("width",$(e).width()+"px");$(e).css("height",$(e).height()+"px");$(e).css("left",(c.pageX-$(e).outerWidth()/2)+"px");$(e).css("top",(c.pageY-$(e).outerHeight()/2)+"px");$.glue.object.register(e);$.glue.object.save(e)});$.glue.menu.hide()});$.glue.menu.register("new",b);b=$('<img src="'+$.glue.base_url+'modules/text/text-background-color.png" alt="btn" title="change background color" width="32" height="32">');var a=false;$(b).bind("click",function(f){var d=$(this).data("owner");var c=$(d).css("background-color");if(f.shiftKey){c=prompt("Enter background color (e.g. #ff0000 or rgb(255, 0, 0))",c);if(!c){return}}$.glue.colorpicker.show(c,false,function(e){$(d).css("background-color",e);$(d).children(".glue-text-input").css("background-color",e)},function(e){$.glue.object.save(d);a=false});a=true});$(b).bind("glue-deselect",function(c){if(a){$.glue.colorpicker.hide();a=false}});$.glue.contextmenu.register("text","text-background-color",b);b=$('<img src="'+$.glue.base_url+'modules/text/text-background-transparent.png" alt="btn" title="make background transparent" width="32" height="32">');$(b).bind("click",function(d){var c=$(this).data("owner");$(c).css("background-color","transparent");$(c).children(".glue-text-input").css("background-color","transparent");$.glue.object.save(c)});$.glue.contextmenu.register("text","text-background-transparent",b);b=$('<img src="'+$.glue.base_url+'modules/text/text-font-size.png" alt="btn" title="drag to change font size, click to reset to default one" width="32" height="32">');$(b).bind("glue-menu-activate",function(d){var c=$(this).data("owner");$(this).attr("title","drag to change font size ("+$(c).css("font-size")+"), click to reset to default one")});$(b).bind("mousedown",function(h){var g=$(this).data("owner");var c=parseInt($(g).css("font-size"));if(isNaN(c)){c=10}var f=true;var d=this;$.glue.slider(h,function(e,k){var j=Math.floor(c+k/6);if(j<0){j=0}$(g).css("font-size",j+"px");$(d).attr("title","drag to change font size ("+j+"px), click to reset to default one");if(e!=0||k!=0){f=false}},function(e,j){if(f){$(g).css("font-size","");$.glue.backend({method:"glue.object_remove_attr",name:$(g).attr("id"),attr:"text-font-size"});$(d).attr("title","drag to change font size ("+$(g).css("font-size")+"px), click to reset to default one")}else{$.glue.object.save(g)}});return false});$.glue.contextmenu.register("text","text-font-size",b);b=$('<img src="'+$.glue.base_url+'modules/text/text-font-color.png" alt="btn" title="change font color" width="32" height="32">');$(b).bind("click",function(f){var d=$(this).data("owner");var c=$(d).css("color");if(f.shiftKey){c=prompt("Enter font color (e.g. #ff0000 or rgb(255, 0, 0))",c);if(!c){return}}$.glue.colorpicker.show(c,false,function(e){$(d).css("color",e)},function(e){$.glue.object.save(d);a=false});a=true});$.glue.contextmenu.register("text","text-font-color",b);b=$('<div class="glue-text-font-family" style="height: 32px; width: 32px;" title="change typeface (click to cycle through available typefaces)">');$(b).bind("glue-menu-activate",function(f){var d=$(this).data("owner");var h=[];var c=[];$.glue.text.get_fonts(h,c);var g=$(d).css("font-family");for(i=0;i<c.length;i++){if(g===c[i]){$("#glue-contextmenu-text-font-face").addClass("glue-text-font-face");$("#glue-contextmenu-text-font-face").removeClass("glue-text-font-family");$("#glue-contextmenu-text-font-face").attr("title","this is a WOFF web-font ("+g+") - while only supported on the latest browser versions, this text should look similar across different browsers and operating systems supporting WOFF");return}}$("#glue-contextmenu-text-font-face").removeClass("glue-text-font-face");$("#glue-contextmenu-text-font-face").addClass("glue-text-font-family");$("#glue-contextmenu-text-font-face").attr("title","change typeface (click to cycle through available typefaces)")});$(b).bind("click",function(g){var f=$(this).data("owner");var l=[];var c=[];$.glue.text.get_fonts(l,c);var j=$(f).css("font-family");var k=false;for(var d=0;d<l.length;d++){if(j===l[d]){if(d+1<l.length){k=d+1}else{k=0}break}}if(k===false&&l.length){k=0}if(k!==false){$(f).css("font-family",l[k]);var h=false;for(var d=0;d<c.length;d++){if(c[d]==l[k]){h=true;break}}if(h){$(this).addClass("glue-text-font-face");$(this).removeClass("glue-text-font-family");$(this).attr("title","this is a WOFF web-font ("+l[k]+") - while only supported on the latest browser versions, this text should look similar across different browsers and operating systems supporting WOFF")}else{$(this).removeClass("glue-text-font-face");$(this).addClass("glue-text-font-family");$(this).attr("title","change typeface (click to cycle through available typefaces)")}$.glue.object.save(f)}});$.glue.contextmenu.register("text","text-font-face",b);b=$('<img src="'+$.glue.base_url+'modules/text/text-font-style.png" alt="btn" title="change font style" width="32" height="32">');$(b).bind("click",function(d){var c=$(this).data("owner");if($(c).css("font-style")=="normal"&&($(c).css("font-weight")=="bold"||$(c).css("font-weight")=="700")){$(c).css("font-style","italic");$(c).css("font-weight","normal")}else{if($(c).css("font-style")=="italic"&&($(c).css("font-weight")=="normal"||$(c).css("font-weight")=="400")){$(c).css("font-style","italic");$(c).css("font-weight","bold")}else{if($(c).css("font-style")=="italic"&&($(c).css("font-weight")=="bold"||$(c).css("font-weight")=="700")){$(c).css("font-style","normal");$(c).css("font-weight","normal")}else{$(c).css("font-style","normal");$(c).css("font-weight","bold")}}}$.glue.object.save(c)});$.glue.contextmenu.register("text","text-font-style",b);b=$('<img src="'+$.glue.base_url+'modules/text/text-line-height.png" alt="btn" title="change line height, click to reset to default one" width="32" height="32">');$(b).bind("glue-menu-activate",function(c){});$(b).bind("mousedown",function(j){var h=$(this).data("owner");var c=parseFloat($(h).css("font-size"));if($(h).css("line-height").substr(-2)=="em"){var d=parseFloat($(h).css("line-height"))*c}else{if($(h).css("line-height").substr(-2)=="px"){var d=parseFloat($(h).css("line-height"))}else{var d=c*1.2}}var g=true;var f=this;$.glue.slider(j,function(e,l){var k=d+l/6;if(k<0){k=0}$(h).css("line-height",(k/c)+"em");if(e!=0||l!=0){g=false}},function(e,k){if(g){$(h).css("line-height","");$.glue.backend({method:"glue.object_remove_attr",name:$(h).attr("id"),attr:"text-line-height"})}else{$.glue.object.save(h)}});return false});$.glue.contextmenu.register("text","text-line-height",b);b=$('<img src="'+$.glue.base_url+'modules/text/text-letter-spacing.png" alt="btn" title="change letter spacing" width="32" height="32">');$(b).bind("glue-menu-activate",function(c){});$(b).bind("mousedown",function(j){var h=$(this).data("owner");var c=parseFloat($(h).css("font-size"));if($(h).css("letter-spacing").substr(-2)=="em"){var d=parseFloat($(h).css("letter-spacing"))*c}else{if($(h).css("letter-spacing").substr(-2)=="px"){var d=parseFloat($(h).css("letter-spacing"))}else{var d=0}}var g=true;var f=this;$.glue.slider(j,function(e,l){var k=d+l/6;$(h).css("letter-spacing",(k/c)+"em");if(e!=0||l!=0){g=false}},function(e,k){if(g){$(h).css("letter-spacing","");$.glue.backend({method:"glue.object_remove_attr",name:$(h).attr("id"),attr:"text-letter-spacing"})}else{$.glue.object.save(h)}});return false});$.glue.contextmenu.register("text","text-letter-spacing",b);b=$('<img src="'+$.glue.base_url+'modules/text/text-word-spacing.png" alt="btn" title="change word spacing" width="32" height="32">');$(b).bind("glue-menu-activate",function(c){});$(b).bind("mousedown",function(j){var h=$(this).data("owner");var c=parseFloat($(h).css("font-size"));if($(h).css("word-spacing").substr(-2)=="em"){var d=parseFloat($(h).css("word-spacing"))*c}else{if($(h).css("word-spacing").substr(-2)=="px"){var d=parseFloat($(h).css("word-spacing"))}else{var d=0}}var g=true;var f=this;$.glue.slider(j,function(e,l){var k=d+l/6;$(h).css("word-spacing",(k/c)+"em");if(e!=0||l!=0){g=false}},function(e,k){if(g){$(h).css("word-spacing","");$.glue.backend({method:"glue.object_remove_attr",name:$(h).attr("id"),attr:"text-word-spacing"})}else{$.glue.object.save(h)}});return false});$.glue.contextmenu.register("text","text-word-spacing",b);b=$('<img src="'+$.glue.base_url+'modules/text/text-align.png" alt="btn" title="change text alignment" width="32" height="32">');$(b).bind("glue-menu-activate",function(d){var c=$(this).data("owner");var f=$(c).css("text-align");if(f=="center"){$(this).attr("title","change text alignment (center)")}else{if(f=="right"){$(this).attr("title","change text alignment (right)")}else{if(f=="justify"){$(this).attr("title","change text alignment (justify)")}else{$(this).attr("title","change text alignment (left)")}}}});$(b).bind("click",function(d){var c=$(this).data("owner");var f=$(c).css("text-align");if(f=="center"){$(c).css("text-align","right");$(this).attr("title","change text alignment (right)")}else{if(f=="right"){$(c).css("text-align","justify");$(this).attr("title","change text alignment (justify)")}else{if(f=="justify"){$(c).css("text-align","left");$(this).attr("title","change text alignment (left)")}else{$(c).css("text-align","center");$(this).attr("title","change text alignment (center)")}}}$.glue.object.save(c)});$.glue.contextmenu.register("text","text-align",b);b=$('<img src="'+$.glue.base_url+'modules/text/text-padding.png" alt="btn" title="change padding, click to reset to default one" width="32" height="32">');$(b).bind("glue-menu-activate",function(d){var c=$(this).data("owner");$(this).attr("title","change padding ("+$(c).css("padding-left")+", "+$(c).css("padding-top")+"), click to reset to default one")});$(b).bind("mousedown",function(k){var j=$(this).data("owner");var d=parseInt($(j).css("padding-left"));if(isNaN(d)){d=0}var g=$(j).width();var c=parseInt($(j).css("padding-top"));if(isNaN(c)){c=0}var l=$(j).height();var h=true;var f=this;$.glue.slider(k,function(m,q,n){var p=Math.floor(d+m/6);if(p<0){p=0}var o=Math.floor(c+q/6);if(o<0){o=0}if(n.shiftKey){if(p<o){p=o}else{if(o<p){o=p}}}$(j).css("padding-left",p+"px");$(j).css("padding-right",p+"px");$(j).css("width",(g+2*d-2*p)+"px");$(j).css("padding-top",o+"px");$(j).css("padding-bottom",o+"px");$(j).css("height",(l+2*c-2*o)+"px");$(f).attr("title","change padding ("+p+"px, "+o+"px), click to reset to default one");if(m!=0||q!=0){h=false}},function(e,o){if(h){var n=parseInt($(j).css("padding-left"));if(!isNaN(n)){$(j).css("width",($(j).width()+2*n)+"px")}var m=parseInt($(j).css("padding-top"));if(!isNaN(m)){$(j).css("height",($(j).height()+2*m)+"px")}$(j).css("padding-left","");$(j).css("padding-right","");$(j).css("padding-top","");$(j).css("padding-bottom","");$(f).attr("title","change padding ("+$(j).css("padding-left")+", "+$(j).css("padding-top")+"), click to reset to default one")}$.glue.object.save(j)});return false});$.glue.contextmenu.register("text","text-text-padding",b);$.glue.object.register_alter_pre_save("text",function(c,d){$(c).children(".glue-text-input").css("background-image","");$(c).children(".glue-text-input").remove();$(c).children(".glue-text-render").remove()})});
