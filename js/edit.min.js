$.glue.canvas=function(){return{update:function(b){if(b===undefined){b=$(".object")}var c=0;var a=0;$(b).each(function(){var d=$(this).position();if(c<d.left+$(this).outerWidth()){c=d.left+$(this).outerWidth()}if(a<d.top+$(this).outerHeight()){a=d.top+$(this).outerHeight()}});if(c<$(window).width()){c=$(window).width()}if(a<$(window).height()){a=$(window).height()}$("body").css("width",c+"px");$("body").css("height",a+"px");$.glue.grid.update()}}}();$.glue.colorpicker=function(){var e=false;var a=false;var f=false;var d=false;var c=$('<div id="glue-colorpicker" class="glue-ui" style="z-index: 202;"><div id="glue-colorpicker-transparent" class="glue-ui"></div><div id="glue-colorpicker-wheel" style="height: 195px; width: 195px;" title="set transparent"></div></div>');$(c).children("#glue-colorpicker-wheel").farbtastic(function(g){if(g!==a){$(c).children("#glue-colorpicker-wheel").find(".marker").attr("title",g);$(c).children("#glue-colorpicker-transparent").removeClass("glue-colorpicker-transparent-set");$(c).children("#glue-colorpicker-transparent").addClass("glue-colorpicker-transparent-notset");if(typeof e=="function"){e(g)}a=g}});$(c).children("#glue-colorpicker-transparent").bind("click",function(g){$(this).addClass("glue-colorpicker-transparent-set");$(this).removeClass("glue-colorpicker-transparent-notset");if(typeof e=="function"){e("transparent")}a="transparent"});var b=function(g){if(!$(g.target).hasClass("glue-ui")&&$(g.target).parents(".glue-ui").length==0){$.glue.colorpicker.hide();g.stopImmediatePropagation()}};return{hide:function(g){if(d){if(g===undefined||g==false){if(typeof f=="function"){f(a)}}$(c).detach();d=false}$("body").unbind("click",b)},is_shown:function(){return d},set_color:function(g){$.color.setColor(g);var h=$.color.getRGB();var i=$.color.getHex();if($(c).children("#glue-colorpicker-transparent").css("display")=="block"){if(h.a==0){$(c).children("#glue-colorpicker-transparent").addClass("glue-colorpicker-transparent-set");$(c).children("#glue-colorpicker-transparent").removeClass("glue-colorpicker-transparent-notset");g="transparent"}else{$(c).children("#glue-colorpicker-transparent").removeClass("glue-colorpicker-transparent-set");$(c).children("#glue-colorpicker-transparent").addClass("glue-colorpicker-transparent-notset")}}else{if(h.r==0&&h.g==0&&h.b==0&&h.a==0){i="#ffffff"}}$.farbtastic($(c).children("#glue-colorpicker-wheel")).setColor(i);$(c).children("#glue-colorpicker-wheel").find(".marker").attr("title",i);a=g},show:function(i,g,j,h){if(d){$.glue.colorpicker.hide()}a=false;e=j;f=h;if(g){$(c).children("#glue-colorpicker-transparent").css("display","block")}else{$(c).children("#glue-colorpicker-transparent").css("display","none")}if(typeof i!="string"||i.length==0){$.farbtastic($(c).children("#glue-colorpicker-wheel")).setColor("#ff0000");$(c).children("#glue-colorpicker-wheel").find(".marker").removeAttr("title")}else{$.glue.colorpicker.set_color(i)}$("body").append(c);d=true;$("body").bind("click",b)}}}();$.glue.contextmenu=function(){var e=10;var g=[];var c={};var b=false;var d=false;var f=[];var a={};$(".object").live("glue-deselect",function(h){$.glue.contextmenu.hide()});$(".object").live("glue-movestart",function(h){if(this==b){d=b;$.glue.contextmenu.hide()}});$(".object").live("glue-movestop",function(h){if(this==d){$.glue.contextmenu.show(d);d=false}});$(".object").live("glue-select",function(h){if($(".glue-selected").length==1){$.glue.contextmenu.show(this)}else{$.glue.contextmenu.hide()}});return{hide:function(){if(b){while(g.length){var h=g.shift();$(h.elem).trigger("glue-menu-deactivate");$(h.elem).detach()}while(f.length){var h=f.shift();$(h.elem).trigger("glue-menu-deactivate");$(h.elem).detach()}b=false}},is_shown:function(){if(b){return true}else{return false}},register:function(h,i,j,k){if(!c[h]){c[h]=[]}if(k===undefined){k=e}c[h].push({name:i,elem:j,prio:k})},reuse:function(j,k,h,o){if(o===undefined){o=e}for(var n in c){for(var l=0;l<c[n].length;l++){if(c[n][l].name==k){var m=$(c[n][l].elem).clone(true);$.glue.contextmenu.register(j,h,m,o);return m}}}return false},show:function(r){if(b){if(r==b){return}else{$.glue.contextmenu.hide()}}if(!$(r).hasClass("locked")){for(var y in c){if($(r).hasClass(y)){var t;if(y=="object"){t=g}else{t=f}for(var s=0;s<c[y].length;s++){var x=false;for(var p=0;p<t.length;p++){if(c[y][s].prio<t[p].prio){t.splice(p,0,c[y][s]);x=true;break}}if(!x){t.push(c[y][s])}}}}}else{var t=g;for(var s=0;s<c.object.length;s++){if(c.object[s]["name"]=="object-lock"){t.push(c.object[s])}}}var m=$(r).attr("class").replace(/\s+/," ").split(" ");for(var y in a){for(var s=0;s<m.length;s++){if(y==m[s]){for(var p=0;p<a[y].length;p++){for(var n=0;n<g.length;n++){if(g[n].name==a[y][p]){g.splice(n,1);n--}}for(var n=0;n<f.length;n++){if(f[n].name==a[y][p]){f.splice(n,1);n--}}}}}}for(var s=0;s<2;s++){var t;var w=$(r).position().left;var v=$(r).position().top;var o=48;if(s==0){t=f;if(g.length){if(w-$(g[0].elem).outerWidth(true)<0){w=$(g[0].elem).outerWidth(true)+o}}else{if(w-o<0){w=o}}}else{t=g;if(f.length){if(v-$(f[0].elem).outerHeight(true)<0){v=$(f[0].elem).outerHeight(true)}}else{if(v-o<0){v=o}}}for(var p=0;p<t.length;p++){$(t[p].elem).attr("id","glue-contextmenu-"+t[p].name);if(t==g){$(t[p].elem).addClass("glue-contextmenu-left")}else{$(t[p].elem).addClass("glue-contextmenu-top")}$(t[p].elem).addClass("glue-ui");$(t[p].elem).css("position","absolute");$(t[p].elem).css("visibility","hidden");$(t[p].elem).css("z-index","201");$("body").append(t[p].elem);if(t==f){$(t[p].elem).css("left",w+"px");var u=v-$(t[p].elem).outerHeight(true);if(u<0){u=0}$(t[p].elem).css("top",u+"px");var h=$(t[p].elem).outerWidth(true)}else{var q=w-$(t[p].elem).outerWidth(true);if(q<0){q=0}$(t[p].elem).css("left",q+"px");$(t[p].elem).css("top",v+"px");var l=$(t[p].elem).outerHeight(true)}$(t[p].elem).data("owner",r);$(t[p].elem).trigger("glue-menu-activate");if($(t[p].elem).css("display")=="none"){continue}if(t==g){v+=l}else{w+=h}$(t[p].elem).css("visibility","");$(t[p].elem).hide();$(t[p].elem).fadeIn(333)}}b=r;d=false;return true},veto:function(h,i){if(!a[h]){a[h]=[]}a[h].push(i)}}}();$.glue.grid=function(){var c=[];var i=[];var h=[];var k=[];var d=false;var j=0;var a=false;var g=50;var e=50;var f=function(){if((j&1)){if(d!==$(document).height()||a!==$(document).width()){b();d=$(document).height();a=$(document).width();var p="#ffffff";if($("body").css("background-color").length){$.color.setColor($("body").css("background-color"));var m=$.color.getArray();if(m[3]!=0){p=$.color.getHex()}}for(var l=g;l<=a;l+=g){var o=$("<div></div>");$(o).addClass("glue-grid-y");$(o).addClass("glue-grid");$(o).addClass("glue-ui");$(o).css("background-color",$.xcolor.complementary(p));$(o).css("height",d+"px");$(o).css("left",l+"px");$(o).css("position","absolute");$(o).css("top","0px");$(o).css("width","1px");$(o).css("z-index","200");$("body").append(o);k.push(o)}for(var q=e;q<=d;q+=e){var o=$("<div></div>");$(o).addClass("glue-grid-x");$(o).addClass("glue-grid");$(o).addClass("glue-ui");$(o).css("background-color",$.xcolor.complementary(p));$(o).css("height","1px");$(o).css("left","0px");$(o).css("position","absolute");$(o).css("top",q+"px");$(o).css("width",a+"px");$(o).css("z-index","200");$("body").append(o);k.push(o)}for(var n in i){var o=$("<div></div>");$(o).addClass("glue-guide-x");$(o).addClass("glue-guide");$(o).addClass("glue-ui");$(o).css("background-color",$.xcolor.average($.xcolor.complementary(p),p));$(o).css("height",d+"px");$(o).css("left",i[n]+"px");$(o).css("position","absolute");$(o).css("top","0px");$(o).css("width","1px");$(o).css("z-index","200");$("body").append(o);c.push(o)}for(var n in h){var o=$("<div></div>");$(o).addClass("glue-guide-y");$(o).addClass("glue-guide");$(o).addClass("glue-ui");$(o).css("background-color",$.xcolor.average($.xcolor.complementary(p),p));$(o).css("height","1px");$(o).css("left","0px");$(o).css("position","absolute");$(o).css("top",h[n]+"px");$(o).css("width",a+"px");$(o).css("z-index","200");$("body").append(o);c.push(o)}}}else{b()}if((j&2)){$(".object").draggable("option","grid",[g,e])}else{$(".object").draggable("option","grid",false)}if((j&4)){$(".resizable").resizable("option","grid",[g,e])}else{$(".resizable").resizable("option","grid",false)}};var b=function(){while(k.length){var m=k.shift();$(m).remove()}while(c.length){var l=c.shift();$(l).remove()}d=false;a=false};return{add_guide_x:function(l){i.push(l)},add_guide_y:function(l){h.push(l)},mode:function(l){if(l===undefined){return j}else{j=l}},update:function(l){if(l!==undefined&&l){d=false;a=false}f()},x:function(l){if(l===undefined){return g}else{g=l}},y:function(l){if(l===undefined){return e}else{e=l}}}}();$.glue.menu=function(){var e=10;var f=false;var a={};var d="";var c=false;var b=function(g){if(!$(g.target).hasClass("glue-ui")&&$(g.target).parents(".glue-ui").length==0){$.glue.menu.hide(false)}};$(".object").live("glue-select",function(g){if(f){$.glue.menu.hide()}});return{hide:function(h){if(h===undefined||h){d=""}if(f){for(var g=0;g<f.length;g++){$(f[g].elem).trigger("glue-menu-deactivate");$(f[g].elem).detach()}f=false}$("body").unbind("click",b)},is_shown:function(g){if(g===undefined){if(f){return true}else{return false}}else{if(a[g]&&a[g]==f){return true}else{return false}}},prev_menu:function(){var g=d;d="";return g},register:function(k,j,l){if(!a[k]){a[k]=[]}if(l===undefined){l=e}var h=false;for(var g=0;g<a[k].length;g++){if(l<a[k][g].prio){a[k].splice(g,0,{elem:j,prio:l});h=true;break}}if(!h){a[k].push({elem:j,prio:l})}},show:function(j,p,n){if(!a[j]){return false}if(f){$.glue.menu.hide()}if(p===undefined){p=$(window).width()/2}if(n===undefined){n=$(window).height()/2}var g=0;var o=0;f=a[j];num_shown=0;for(var l=0;l<f.length;l++){var k=f[l].elem;$(k).addClass("glue-menu-"+j);$(k).addClass("glue-menu");$(k).addClass("glue-ui");$(k).css("left",p+"px");$(k).css("position","fixed");$(k).css("top",n+"px");$(k).css("visibility","hidden");$(k).css("z-index","201");$("body").append(k);$(k).trigger("glue-menu-activate");if($(k).css("display")=="none"){continue}else{num_shown++}if(g<$(k).outerWidth(true)){g=$(k).outerWidth(true)}if(o<$(k).outerHeight(true)){o=$(k).outerHeight(true)}}var r=1;while(r*r<num_shown){r++}var m=r;if(num_shown<=r*(r-1)){m--}var q=0;var h=0;for(var l=0;l<f.length;l++){var k=f[l].elem;if($(k).css("display")=="none"){continue}if(h==m){q++;h=0}$(k).css("opacity","0.0");$(k).css("visibility","");$(k).animate({left:(p-(r*g)/2+h*g)+"px",opacity:1,top:(n-(r*o)/2+q*o)+"px"},200);h++}$("body").bind("click",b);d=j;c={x:$(document).scrollLeft()+p,y:$(document).scrollTop()+n};return true},spawn_coords:function(){return c}}}();$.glue.object=function(){var b={};var a=false;var c={};$(".resizable").live("glue-pre-clone",function(d){$(this).removeClass("ui-resizable");$(this).children(".ui-resizable-handle").remove()});$(".object").live("resize",function(d){if(d.ctrlKey){if($(this).resizable("option","grid")!==false){a=$(this).resizable("option","grid");$(this).resizable("option","grid",false)}}else{if(a){$(this).resizable("option","grid",a);a=false}}$.glue.object.resizable_update_tooltip(this);$(this).trigger("glue-resize")});$(".object").live("resizestart",function(d){$(this).trigger("glue-resizestart")});$(".object").live("resizestop",function(d){if(a){$(this).resizable("option","grid",a);a=false}$.glue.object.save(this);$(this).trigger("glue-resizestop");$.glue.canvas.update(this)});$(document).ready(function(){$.glue.object.register_alter_pre_save("resizable",function(d,e){$(d).removeClass("ui-resizable");$(d).children(".ui-resizable-handle").remove()});$.glue.object.register_alter_pre_save("object",function(d,e){$(d).removeClass("ui-draggable-dragging")});$.glue.object.register_alter_pre_save("glue-selected",function(f,g){var d=$(g).outerHeight()-$(g).innerHeight();var e=$(g).position();$(f).removeClass("glue-selected");$(f).css("left",(e.left+d/2)+"px");$(f).css("top",(e.top+d/2)+"px")})});return{register:function(d){if(c[$(d).attr("id")]){return false}else{c[$(d).attr("id")]=true}if(isNaN(parseInt($(d).css("z-index")))){$(d).css("z-index",$.glue.stack.default_z())}$(d).draggable({addClasses:false,distance:10});if($(d).hasClass("resizable")){$(d).resizable();$.glue.object.resizable_update_tooltip(d)}$(d).trigger("glue-register");$.glue.canvas.update(d)},register_alter_pre_save:function(d,e){b[d]=e},resizable_update_tooltip:function(e){var d=$(e).position();$(e).children(".ui-resizable-handle").attr("title",$(e).innerWidth()+"x"+$(e).innerHeight()+" at "+d.left+"x"+d.top)},save:function(g){var f=$(g).clone();var h=$(f).attr("class").replace(/\s+/," ").split(" ");for(var e=0;e<h.length;e++){if(typeof b[h[e]]=="function"){b[h[e]](f,g)}}$(f).html($.trim($(f).html()));var d=$("<div></div>").html(f).html();$.glue.backend({method:"glue.save_state",html:d})},unregister:function(d){$(d).trigger("glue-unregister")}}}();$.glue.sel=function(){var g=false;var d=false;var b=false;var f=false;var c=false;var e=false;var e=false;var a=false;$("html").bind("click",function(h){if(h.target==$("body").get(0)){if($(".glue-selected").length){$.glue.sel.none();h.stopImmediatePropagation()}}});$("html").bind("keydown",function(o){if(o.which==9){if($(".glue-selected").length<2){var m=false;if($(".glue-selected").next(".object").length){m=$(".glue-selected").next(".object")}else{m=$(".object").first()}if(m){$.glue.sel.none();$.glue.sel.select(m);var s=$(document).scrollLeft();var j=s+$(window).width();var q=$(document).scrollTop();var i=q+$(window).height();var n=$(m).outerHeight();var k=$(m).position();var r=$(m).outerWidth();if(k.left<s){$(document).scrollLeft(k.left)}else{if(j<k.left+r){$(document).scrollLeft(s+k.left+r-j)}}if(k.top<q){$(document).scrollTop(k.top)}else{if(i<k.top+n){$(document).scrollTop(q+k.top+n-i)}}}}return false}else{if(33==o.which&&o.shiftKey&&$(".glue-selected").length){return false}else{if(34==o.which&&o.shiftKey&&$(".glue-selected").length){return false}else{if(37<=o.which&&o.which<=40&&$(".glue-selected").length){var u=0;var t=0;if(o.which==38){t=-1}else{if(o.which==39){u=1}else{if(o.which==40){t=1}else{if(o.which==37){u=-1}}}}if(o.shiftKey){u*=$.glue.grid.x();t*=$.glue.grid.y()}$(".glue-selected").not(".locked").each(function(){var h=$(this).position();if(1<h.left+u+$(this).outerWidth()){$(this).css("left",(h.left+u)+"px")}if(1<h.top+t+$(this).outerHeight()){$(this).css("top",(h.top+t)+"px")}});if($(".glue-selected").length==1){var s=$(document).scrollLeft();var j=s+$(window).width();var q=$(document).scrollTop();var i=q+$(window).height();var l=$(".glue-selected");var k=$(l).position();var r=$(l).outerWidth();var n=$(l).outerHeight();if(k.left<s){$(document).scrollLeft(k.left)}else{if(j<k.left+r){$(document).scrollLeft(k.left+r)}}if(k.top<q){$(document).scrollTop(k.top)}else{if(i<k.top+n){$(document).scrollTop(k.top+n)}}}if(!a){$(".glue-selected").not(".locked").trigger("glue-movestart");a=true}return false}else{if(o.ctrlKey&&o.which==65){$(".object").not(".glue-selected").not(".locked").each(function(){$.glue.sel.select($(this))});$(".locked.glue-selected").each(function(){$.glue.sel.deselect($(this))});return false}else{if(o.ctrlKey&&o.which==68){$.glue.sel.none();return false}else{if(o.ctrlKey&&o.which==73){var m=$(".object").not(".glue-selected").not(".locked");$.glue.sel.none();$(m).each(function(){$.glue.sel.select($(this))});return false}else{}}}}}}}});$("html").bind("keyup",function(h){if(33==h.which&&h.shiftKey&&$(".glue-selected").length){$(".glue-selected").not(".locked").each(function(){$.glue.stack.to_top($(this));$.glue.object.save($(this))});$.glue.stack.compress();return false}else{if(34==h.which&&h.shiftKey&&$(".glue-selected").length){$(".glue-selected").not(".locked").each(function(){$.glue.stack.to_bottom($(this));$.glue.object.save($(this))});$.glue.stack.compress();return false}else{if(37<=h.which&&h.which<=40&&$(".glue-selected").length){$(".glue-selected").not(".locked").trigger("glue-movestop");a=false;return false}else{if(h.which==46&&$(".glue-selected").length){var i=$(".glue-selected").not(".locked");$(i).each(function(){var j=$(this).attr("id");$.glue.object.unregister($(this));$(this).remove();$.glue.backend({method:"glue.delete_object",name:j});$.glue.canvas.update()});return false}else{}}}}});$(".object").live("dragstart",function(h){f=$(this).position().left;c=$(this).position().top;e=h.pageX;drag_mouse_start_y=h.pageY;$(this).draggable("option","axis",false);if(!$(this).hasClass("glue-selected")){$(this).trigger("glue-movestart")}});$(".object").live("dragstop",function(h){if(g){$(this).draggable("option","grid",g);g=false}});$(".object").live("drag",function(j){if(j.ctrlKey){if($(this).draggable("option","grid")!==false){g=$(this).draggable("option","grid");$(this).draggable("option","grid",false)}}else{if(g){$(this).draggable("option","grid",g);g=false}}if(j.shiftKey){var h;if(Math.abs(j.pageX-e)<Math.abs(j.pageY-drag_mouse_start_y)){h="y"}else{h="x"}var i=Math.abs(Math.abs(j.pageX-e)-Math.abs(j.pageY-drag_mouse_start_y));if($(this).draggable("option","axis")==false){$(this).css("left",f+"px");$(this).css("top",c+"px");$(this).draggable("option","axis",h)}else{if(50<i&&$(this).draggable("option","axis")!=h){$(this).css("left",f+"px");$(this).css("top",c+"px");$(this).draggable("option","axis",h)}}}else{$(this).draggable("option","axis",false)}});$(".object").live("dragstop",function(h){if(!$(this).hasClass("glue-selected")){$(this).trigger("glue-movestop")}});$(".glue-selected").live("drag",function(j){if(1<$(".glue-selected").length){var h=this;var i=$(this).position();$(".glue-selected").each(function(){if(this==h){return}var k=$(this).position();$(this).css("left",(k.left+i.left-d)+"px");$(this).css("top",(k.top+i.top-b)+"px")});d=i.left;b=i.top}});$(".glue-selected").live("dragstart",function(i){if(1<$(".glue-selected").length){var h=$(this).position();d=h.left;b=h.top}$(".glue-selected").trigger("glue-movestart")});$(".glue-selected").live("dragstop",function(j){var h=this;var i=$(this).position();$(".glue-selected").each(function(){if(this==h){return}var k=$(this).position();$(this).css("left",(k.left+i.left-d)+"px");$(this).css("top",(k.top+i.top-b)+"px")});$(".glue-selected").trigger("glue-movestop")});$(".object").live("click",function(h){if(!h.shiftKey&&!$(this).hasClass("glue-selected")){$.glue.sel.none()}if(h.shiftKey&&$(this).hasClass("glue-selected")){$.glue.sel.deselect($(this))}else{if(h.shiftKey&&$(this).hasClass("locked")||$(".glue-selected").hasClass("locked")){return}else{$.glue.sel.select($(this))}}});$(".object").live("glue-movestop",function(h){$.glue.object.resizable_update_tooltip(this);$.glue.object.save(this);$.glue.canvas.update(this)});$(".object").live("glue-unregister",function(h){$.glue.sel.deselect($(this))});return{deselect:function(j){if($(j).hasClass("glue-selected")){var h=$(j).outerHeight()-$(j).innerHeight();$(j).removeClass("glue-selected");$(j).trigger("glue-deselect");var i=$(j).position();$(j).css("left",(i.left+h/2)+"px");$(j).css("top",(i.top+h/2)+"px")}},none:function(){$(".glue-selected").each(function(){$.glue.sel.deselect($(this))})},select:function(j){if(!$(j).hasClass("glue-selected")){$(j).addClass("glue-selected");$(j).trigger("glue-select");var i=$(j).position();var h=$(j).outerHeight()-$(j).innerHeight();$(j).css("left",(i.left-h/2)+"px");$(j).css("top",(i.top-h/2)+"px")}},selected:function(h){return $(h).hasClass("glue-selected")}}}();$.glue.slider=function(){return function(d,g,a){var c=d;var b=function(h){if(typeof g=="function"){g(h.pageX-c.pageX,h.pageY-c.pageY,h)}return false};var f=function(h){$("html").unbind("mousemove",b);$("html").unbind("mouseup",f);if(typeof g=="function"){g(h.pageX-c.pageX,h.pageY-c.pageY,h)}if(typeof a=="function"){a(h.pageX-c.pageX,h.pageY-c.pageY,h)}return false};$("html").bind("mousemove",b);$("html").bind("mouseup",f)}}();$.glue.stack=function(){var a=100;var c=199;var d=0;var b=function(h,e){var j=$(h).outerHeight();var l=$(h).position();var g=$(h).outerWidth();var f=$(e).outerHeight();var i=$(e).position();var k=$(e).outerWidth();if((l.left<=i.left+k&&i.left<=l.left+g)&&(l.top<=i.top+f&&i.top<=l.top+j)){return true}else{return false}};return{compress:function(){var e=d-1;var h=c+1;var f=0;$(".object").not(".locked").each(function(){var i=parseInt($(this).css("z-index"));if(isNaN(i)){return}if(i<h){h=i}if(e<i){e=i}});for(var g=h;g<=e;g++){var j=false;$(".object").not(".locked").each(function(){var i=parseInt($(this).css("z-index"));if(isNaN(i)){return}else{if(i==g){j=true}}});if(!j){e--;$(".object").not(".locked").each(function(){var i=parseInt($(this).css("z-index"));if(isNaN(i)){return}else{if(g<i){$(this).css("z-index",--i);$(this).addClass("need_save")}}})}}f=a-Math.round((e-h)/2)-h;if(Math.abs(f)<20){f=0}else{$(".object").addClass("need_save")}$(".need_save").each(function(){var i=parseInt($(this).css("z-index"));if(!isNaN(i)){$(this).css("z-index",i+f);$.glue.object.save(this)}$(this).removeClass("need_save")})},default_z:function(){return a},to_bottom:function(f){var e=c+1;var g=parseInt($(f).css("z-index"));$(".object").not(".locked").each(function(){if(this==$(f).get(0)){return}if(!b(f,this)){return}else{}if($(this).css("z-index").length){var h=parseInt($(this).css("z-index"));if(!isNaN(h)&&h<e){e=h}}});if(isNaN(g)||e<=g){if(e<=c&&d<e){$(f).css("z-index",e-1);return true}}return false},to_top:function(f){var e=d-1;var g=parseInt($(f).css("z-index"));$(".object").not(".locked").each(function(){if(this==$(f).get(0)){return}if(!b(f,this)){return}else{}if($(this).css("z-index").length){var h=parseInt($(this).css("z-index"));if(!isNaN(h)&&e<h){e=h}}});if(isNaN(g)||g<=e){if(d<=e&&e<c){$(f).css("z-index",e+1);return true}}return false}}}();$.glue.upload=function(){var a=function(c,b){if(c===undefined){c=0}if(b===undefined){b=0}var d=0;return{error:function(f){d--;if(d==0){$(this.status).detach()}if(f&&f.target&&f.target.status){$.glue.error("There was a problem uploading a file (status "+f.target.status+")")}else{$.glue.error("There was a problem uploading a file. Make sure you are not exceeding the file size limits set in the server configuration.");console.error(f)}},finish:function(e){d--;if(d==0){$(this.status).detach()}$.glue.upload.handle_response(e,this.x,this.y)},progress:function(f){$(this.status).children(".glue-upload-statusbar-done").css("width",(f.loaded/f.total*100)+"%");$(this.status).attr("title",f.loaded+" of "+f.total+" bytes ("+(f.loaded/f.total*100).toFixed(1)+"%)")},start:function(f){$.glue.menu.hide();d++;$("body").append(this.status);$(this.status).children(".glue-upload-statusbar-done").css("width","0%");$(this.status).css("left",(this.x-$(this.status).outerWidth()/2)+"px");$(this.status).css("top",(this.y-$(this.status).outerHeight()/2)+"px")},status:$('<div class="glue-upload-statusbar glue-ui" style="position: absolute; z-index: 202;"><div class="glue-upload-statusbar-done"></div></div>'),x:c,y:b}};$(document).ready(function(){var c=$('<div style="height: 32px; max-height: 32px; max-width: 32px; overflow: hidden; width: 32px;"><img src="'+$.glue.base_url+'img/upload.png" alt="btn" width="32" height="32"></div>');var b=a();b.multiple=true;$.glue.upload.button(c,{method:"glue.upload_files",page:$.glue.page},b);$(c).bind("click",function(f){var d=$.glue.menu.spawn_coords();b.x=d.x;b.y=d.y});$.glue.menu.register("new",c,11);$("html").get(0).addEventListener("dragover",function(d){d.stopPropagation();d.preventDefault()},false);$("html").get(0).addEventListener("drop",function(f){f.stopPropagation();f.preventDefault();var d=a(f.pageX,f.pageY);$.glue.upload.files(f.dataTransfer.files,{method:"glue.upload_files",page:$.glue.page},d)},false)});return{button:function(c,d,b){if(!b){b={}}if(!b.tooltip){b.tooltip="upload a file"}$(c).prepend('<input type="file" title="'+b.tooltip+'" style="height: 100%; opacity: 0; position: absolute; width: 100%; z-index: 300;">');if(b.multiple){$(c).children("input").first().attr("multiple","multiple")}$(c).children("input").first().bind("change",function(f){if(!this.files||this.files.length==0){if(typeof b.abort=="function"){b.abort()}return false}else{$.glue.upload.files(this.files,d,b);return false}})},files:function(b,e,m){if(!e){e={}}if(!m){m={}}var l=new XMLHttpRequest();if(typeof m.progress=="function"){l.upload.onprogress=function(f){m.progress(f)}}if(typeof m.finish=="function"){l.onload=function(f){try{m.finish($.parseJSON(f.target.responseText))}catch(f){if(typeof m.error=="function"){m.error(f)}}}}if(typeof m.error=="function"){l.onerror=function(f){m.error(f)}}l.open("POST",$.glue.base_url+"json.php",true);if(window.FormData){var j=new FormData();for(var k in e){j.append(k,JSON.stringify(e[k]))}for(var g=0;g<b.length;g++){j.append("user_file"+g,b[g])}l.send(j);if(typeof m.start=="function"){m.start(b)}return true}else{if(b[0]&&b[0].getAsBinary){var c="----multipartformboundary"+(new Date).getTime();var h="";for(var k in e){h+="--"+c+"\r\n";h+='Content-Disposition: form-data; name="'+k+'"\r\n';h+="\r\n";h+=JSON.stringify(e[k])+"\r\n"}for(var g=0;g<b.length;g++){var d=b[g];h+="--"+c+"\r\n";h+='Content-Disposition: form-data; name="user_file'+g+'"';if(d.fileName){h+='; filename="'+d.fileName+'"'}h+="\r\n";if(d.type){h+="Content-Type: "+d.type+"\r\n"}else{h+="Content-Type: application/octet-stream\r\n"}h+="\r\n";h+=d.getAsBinary();h+="\r\n"}h+="--"+c+"--\r\n";l.setRequestHeader("Content-Type","multipart/form-data; boundary="+c);l.sendAsBinary(h);if(typeof m.start=="function"){m.start(b)}return true}else{$.glue.error("Your browser is not supported. Update to a recent version of Firefox or Chrome.");if(typeof m.abort=="function"){m.abort()}return false}}},handle_response:function(f,k,j){if(!f){$.glue.error("There was a problem communicating with the server")}else{if(f["#error"]){$.glue.error("There was a problem uploading the file ("+f["#data"]+")")}else{if(f["#data"].length==0){$.glue.error("The server did not reply with any object. The file type you were uploading could either not be supported (look around for more modules!) or there could be an internal problem. Check the log file to be sure!");return}$.glue.sel.none();for(var g=0;g<f["#data"].length;g++){var e=$(f["#data"][g]);var l=function(o){var p=o.data.mode;var m=o.data.target_x;var i=o.data.target_y;if($(this).hasClass("object")){var n=$(this)}else{var n=$(this).parents(".object").first()}$(n).css("width",$(n).width()+"px");$(n).css("height",$(n).height()+"px");$(n).trigger("glue-upload-dynamic-late",[this]);if(p=="center"){$(n).css("left",(m-$(n).outerWidth()/2)+"px");$(n).css("top",(i-$(n).outerHeight()/2)+"px")}else{$(n).css("left",(m+"px"));$(n).css("top",(i+"px"))}$(n).css("visibility",$(n).data("orig_visibility"));$(n).removeData("orig_visibility");$.glue.object.register(n);$.glue.object.save(n)};if(f["#data"].length==1){var h="center";var d=k;var c=j}else{var h="stack";var d=k+g*$.glue.grid.x();var c=j+g*$.glue.grid.y()}var b=parseInt($(e).get(0).style.getPropertyValue("width"));if(isNaN(b)||b===0){$(e).bind("load",{mode:h,target_x:d,target_y:c},l);$(e).find("*").bind("load",{mode:h,target_x:d,target_y:c},l);$(e).data("orig_visibility",$(e).css("visibility"));$(e).css("visibility","hidden");$("body").append(e);$(e).trigger("glue-upload-dynamic-early",[h,d,c])}else{$("body").append(e);if(h=="center"){$(e).css("left",(d-$(e).outerWidth()/2)+"px");$(e).css("top",(c-$(e).outerHeight()/2)+"px")}else{$(e).css("left",(d+"px"));$(e).css("top",(c+"px"))}$.glue.object.register(e);$(e).trigger("glue-upload-static",[h]);$.glue.object.save(e)}}}}}}}();$(document).ready(function(){$(".object").each(function(){$.glue.object.register($(this))});$.glue.canvas.update();var b;$(window).bind("resize",function(c){clearTimeout(b);b=setTimeout(function(){$.glue.canvas.update()},100)});var a=false;$("html").bind("click",function(c){window.focus();if(c.target==$("body").get(0)){if(!$.glue.menu.is_shown()){if(a){clearTimeout(a);a=false;$.glue.menu.show("page",c.clientX,c.clientY);return false}a=setTimeout(function(){a=false;if($.glue.menu.prev_menu()==""){$.glue.menu.show("new",c.clientX,c.clientY)}},300)}}});$("html").bind("keyup",function(c){if(c.altKey&&c.which==79){$.glue.menu.show("new");return false}else{if(c.altKey&&c.which==80){$.glue.menu.show("page");return false}else{if(c.ctrlKey&&c.which==90){if(confirm('Looking for an "undo" option?\nHOTGLUE keeps record of your recent edits - it\'s called "revisions".\nWould you like to browse through the revisions of this page?')){window.location=$.glue.base_url+"?"+$.glue.page+"/revisions";return false}}}}});$("html").bind("mousedown",function(c){return false})});